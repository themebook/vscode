<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>12_배열심화.html</title>
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=star,star_half" />
  <style>
    table, tr, th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }

    th {
      background-color: peru;
    }

    td.name {
      font-style: italic;
      padding: 3px;
      text-align: center;
    }

    caption::before {
      content: "<<";
    }

    caption::after {
      content: ">>";
    }

    .red {
      color: red;
    }
  </style>
</head>

<body>

  <h3># 배열 멋있게 다루기</h3>

  <table id="table1" border="1"></table>

  <table id="평균" border="1"></table>

  <table id="수학미만" border="1"></table>

  <table id="basic_info_table">
    <thead></thead>
    <tbody></tbody>
  </table>

  <table id="avg_info_table">
    <caption>평균 점수 정보</caption>
    <thead></thead>
    <tbody></tbody>
  </table>

  <table id="math_failure_table">
    <caption>수학 낙제자 정보</caption>
    <thead></thead>
    <tbody></tbody>
  </table>

  <script>
    const arr = [1, 2, 3, 4, 5, 6];

    // 배열.forEach(콜백): 배열의 모든 값을 활용해 전달한 함수를 실행한다
    arr.forEach((value, index, original) => {
      console.log(`값: ${value}, ${index}번째 요소`);
      console.log(`원본 배열: ${original}`);
    });

    const scores = [90, 91, 75, 68, 88, 45, 60, -1, 5000];

    // 배열.map(콜백): 배열의 각 값으로 콜백을 실행한 결과로 이루어진 새 배열을 반환

    const examResult = scores.map(score => score >= 60 ? 'pass' : 'fail');

    console.log(examResult);

    // 연습1: scores 배열로 grades 배열을 생성해보세요
    const grades = scores.map(score => score > 100 || score < 0 ? 'F' : score >= 90 ? 'A' : score >= 80 ? 'B' : score >= 70 ? 'C' : 'D');

    const gg = scores.map(score => {
      return score > 100 || score < 0 ? 'F' : score >= 90 ? 'A' : score >= 80 ? 'B' : score >= 70 ? 'C' : 'D';
    });

    console.log(grades);
    console.log(gg);

    // 선생님 연습1
    const samGrades = scores.map(score => {
      if (score > 100) {
        return 'F';
      } else if (score >= 90) {
        return 'A';
      } else if (score >= 80) {
        return 'B';
      } else if (score >= 70) {
        return 'C';
      } else if (score >= 60) {
        return 'D';
      } else {
        return 'F';
      }
    });

    console.log(samGrades);

    // 연습2: 다음 객체 배열에 평균 점수를 추가한 새로운 배열을 만들기
    const students = [
      {
        name: '유재석',
        kor: 90,
        eng: 88,
        math: 80
      },
      {
        name: '빌 게이츠',
        kor: 15,
        eng: 100,
        math: 99
      },
      {
        name: '마이클 조던',
        kor: 33,
        eng: 44,
        math: 13
      }
    ];

    const students2 = students.map(st => {
      const stu = { ...st };
      stu.avg = Math.round((st.kor + st.eng + st.math) / 3);
      return stu;
    });

    console.log(students);
    console.log(students2);

    // 선생님 문제2

    // 총합구하기, 평균구하기
    const getTotal = stu => stu.kor + stu.eng + stu.math;
    const getAvg = stu => getTotal(stu) / 3;

    // ...으로 배열뿐만 아니라 객체도 풀어서 사용할 수 있다

    // 화살표 함수의 리턴 축약 버전으로 객체를 리턴하기 위해서는
    // {}를 ()괄호로 감싸주어야한다
    const students3 = students.map(stu => ({
      ...stu,
      avg: getAvg(stu),
      total: getTotal(stu)
    }));

    console.log(students3);

    // 배열.filter(콜백): 값들 중에 콜백을 실행한 결과가 true인 요소만 남긴 새 배열을 반환하는 메서드
    const filterResult = students3.filter(stu => stu.eng >= 80);
    console.log(filterResult);

    const snacks = ['초코파이', '엄마손파이', '포테토칩', '포카칩', '웰치스', '제로콜라', '초코하임', '치토스'];

    const pies = snacks.filter(snack => snack.endsWith('파이'));
    console.log(pies);

    // 배열을 리턴하는 메서드의 경우 이렇게 연쇄적으로 활용할 수 있다 (메서드 체이닝)
    snacks
      .filter(snack => snack.endsWith('칩'))
      .forEach(snack => console.log(`남은과자: ${snack}`));

    // 배열.reduce(콜백): 배열의 모든 값을 활용하여 하나의 결과를 도출해내기 위해 사용한다
    // 콜백의 첫 번째 인자로는 누적값이 오고 두 번째 인자로는 현재 값이 온다.
    const totalScore = scores.reduce((acc, curr, index, original) => {
      console.log('acc', acc);
      console.log('curr:', curr);
      console.log('index:', index);
      console.log('original:', original);

      // 여기서 리턴하는 값이 계속 누적된다
      return acc + curr;
    });

    console.log('총합:', totalScore);

    const bestScore = scores.reduce((acc, curr) => acc < curr ? curr : acc);

    console.log('최고점수:', bestScore);

    /*
      (1) 학번, 이름, 국어, 영어, 수학, 수업 만족도(별 0 ~ 5)를 가진
          학생 100명의 자바스크립트 오브젝트를 랜덤으로 생성하기

      (2) 모든 학생들의 정보를 HTML에 테이블 형태로 출력하기
          (60점 미만인 점수는 빨간 글씨로 출력하기, 수업 만족도는 별의 개수로 출력하기)

      (3) 모든 학생들의 평균 점수를 HTML에 테이블 형태로 출력하기

      (4) 수학 점수가 60점 미만인 학생들로 이루어진 테이블 HTML에 출력하기

      (5) 2번의 마지막 행에는 각 열의 총합과 평균을 출력하기
    */

    const names1 =
      ['강', '고', '곽', '구', '권', '기', '김', '나', '남', '노',
        '문', '박', '배', '백', '변', '서', '석', '성', '손', '송',
        '신', '심', '양', '어', '염', '오', '우', '원', '유', '윤',
        '이', '임'];
    const names2 =
      ['강민', '강영', '강준', '강희', '고민', '고은', '고준', '영민', '수영', '구민',
        '구은', '구정', '수민', '산영', '주희', '기민', '기영', '김민', '김영', '김준',
        '주희', '나민', '나영', '나은', '남민', '남영', '노민', '노영', '문민', '문영',
        '문준', '문희', '박민', '박영', '박준', '박희', '배민', '배영', '배준', '백민',
        '백영', '백준', '변민', '변영', '변준', '서민', '서영', '서준', '서희', '석민',
        '석영', '성민', '성영', '성준', '손민', '손영', '손준', '송민', '송영', '송준',
        '신민', '신영', '신준', '심민', '심영', '심준', '양민', '양영', '양준', '어민'];

    const getRandomNum = () => parseInt(Math.random() * 100 + 1);
    const getRandomName = () => `${names1[parseInt(Math.random() * names1.length)]}${names2[parseInt(Math.random() * names2.length)]}`;

    const getStar = () => parseInt(Math.random() * 5 + 1);
    const getStarImage = () => {
      let s = '';
      for (let i = 0; i < getStar(); i++) {
        s += '★';
      }
      return s;
    };
    const setTD = (n) => {
      return n < 60 ? `<td style="color: red;">${n}</td>` : `<td>${n}</td>`;
    };
    const stuArr = [];

    for (let i = 0; i < 100; i++) {
      stuArr[i] = {
        학번: i + 101,
        이름: getRandomName(),
        국어: getRandomNum(),
        영어: getRandomNum(),
        수학: getRandomNum(),
        수업만족도: getStar()
      }
    }
    console.log(stuArr);

    const table1 = document.getElementById('table1');
    table1.innerHTML = `<tr>
      <th>학번</th>
      <th>이름</th>
      <th>국어</th>
      <th>영어</th>
      <th>수학</th>
      <th>수업 만족도</th>
      </tr>`;

    stuArr.forEach(s => {
      table1.innerHTML += `
        <tr>
          <td>${s.학번}</td>
          <td>${s.이름}</td>
          ${setTD(s.국어)}
          ${setTD(s.영어)}
          ${setTD(s.수학)}
          <td>${getStarImage()}</td>
        </tr>`;
    });

    const result = stuArr.reduce((acc, curr) => {
      acc.국어총합 += curr.국어;
      acc.영어총합 += curr.영어;
      acc.수학총합 += curr.수학;
      acc.만족총합 += curr.수업만족도;
      return acc;
    },
      { 국어총합: 0, 영어총합: 0, 수학총합: 0, 만족총합: 0 }
    );

    const 국어평균 = result.국어총합 / stuArr.length;
    const 영어평균 = result.영어총합 / stuArr.length;
    const 수학평균 = result.수학총합 / stuArr.length;
    const 만족평균 = result.만족총합 / stuArr.length;

    const 평균 = document.getElementById('평균');
    평균.innerHTML = '<tr><th>국어</th><th>영어</th><th>수학</th><tr>';
    평균.innerHTML += `<tr><td>${국어평균}</td><td>${영어평균}</td><td>${수학평균}</td></tr>`;

    const 수학미만 = document.getElementById('수학미만');
    수학미만.innerHTML = '<tr><th colspan="3">수학이 60점 미만인 학생들</th><tr>';

    stuArr.forEach(s => {
      if (s.수학 < 60) {
        수학미만.innerHTML += `<td>${s.이름}</td>`;
      }
    });

    const getStarIcon = n => {
      let s = '';
      while (n > 1) {
        s += '<span class="material-symbols-outlined">star</span>';
        n--;
      }
      if (n > 0.5) {
        s += '<span class="material-symbols-outlined">star_half</span>';
      }
      return s;
    };

    table1.innerHTML += `
    <tr>
      <td colspan="2">국어총합/평균</td>
      <td colspan="2">영어총합/평균</td>
      <td colspan="2">수학총합/평균</td>
    </tr>`;
    table1.innerHTML += `
    <tr>
      <td colspan="2">${result.국어총합}/${국어평균}</td>
      <td colspan="2">${result.영어총합}/${영어평균}</td>
      <td colspan="2">${result.수학총합}/${수학평균}</td>
    </tr>`;

    table1.innerHTML += `
    <tr>
      <td colspan="2">만족도 평균</td>
      <td colspan="4"; align="center">${result.만족총합}/${getStarIcon(만족평균)}</td>
    </tr>`;

    // 샘 1번 문제

    let stu_count = 1;
    const getRandomNameFrag = candidates => candidates[parseInt(Math.random() * candidates.length)];
    const getRandomName2 = () => getRandomNameFrag(names1) + getRandomNameFrag(names2);

    const getPaddedNum = (num, size) => {
      let paddedResult = num.toString();

      for (let i = paddedResult.length; i < size; i++) {
        paddedResult = '0' + paddedResult;
      }

      return paddedResult;
    };

    const getStuNum = () => `STU${getPaddedNum(stu_count++, 8)}`;
    const getRandomScore = () => parseInt(Math.random() * 101);
    const getRandomStar = () => parseInt(Math.random() * 6);

    const stus = [];

    for (let i = 0; i < 100; i++) {
      stus.push({
        id: getStuNum(),
        name: getRandomName2(),
        kor: getRandomScore(),
        eng: getRandomScore(),
        math: getRandomScore(),
        star: getRandomStar()
      });
    }

    console.log(stus);

    // 샘 2번 문제

    const addRow = (tableId, data, part) => {
      const toAdd = document.querySelector(`#${tableId} > ${part}`);

      let row = '<tr>';
      if (part === 'thead') {
        for (key in data) {
          row += `<th class='${key}'>${key}</th>`;
        }
      } else {
        for (key in data) {
          if (key === 'math' || key === 'eng' || key === 'kor') {
            const score = data[key];
            row += `<td class="${key} ${score < 60 ? 'red' : ''}">${data[key]}</td>`;
          } else if (key === 'star') {
            const starLen = data[key];
            row += `<td class"${key}">`;
            for (let i = 0; i < starLen; i++) {
              row += '★';
            }
            for (let i = starLen; i < 5; i++) {
              row += '☆';
            }
            row += '</td>';
          } else {
            row += `<td class="${key}"">${data[key]}</td>`;
          }
        }
      }
      row += '</tr>';
      toAdd.innerHTML += row;
    };

    const addBodyRow = (tableId, data) => addRow(tableId, data, 'tbody');
    const addHeadRow = (tableId, data) => addRow(tableId, data, 'thead');

    stus.forEach((stu, index) => {
      const tableId = 'basic_info_table';
      if (index == 0) {
        addHeadRow(tableId, stu);
      }
      addBodyRow(tableId, stu);
    });

    // 샘 3번 문제
    stus.map(stu => ({
      학번: stu.id,
      이름: stu.name,
      평균점수: Math.round((stu.kor + stu.eng + stu.math) / 3 * 100) / 100
    }))
      .forEach((stu, index) => {
        const tableId = 'avg_info_table'
        if (index == 0) {
          addHeadRow(tableId, stu);
        }
        addBodyRow(tableId, stu);
      });

    // 샘 4번 문제
    // 수학이 60점 미만인 사람을 filter
    stus.filter(stu => stu.math < 60)
      .map(stu => ({
        학번: stu.id,
        낙제자: stu.name,
        수학점수: stu.math
      }))
      .forEach((stu, index) => {
        const tableId = 'math_failure_table';
        if (index == 0) {
          addHeadRow(tableId, stu);
        }
        addBodyRow(tableId, stu);
      });
    
    // 샘 5번 문제
    document.querySelector('#basic_info_table > tbody')
      .innerHTML += `<tr>
        <td colspan="2">총합</td>
        <td>${stus.reduce((acc, curr) => acc + curr.kor, 0)}</td>
        <td>${stus.reduce((acc, curr) => acc + curr.eng, 0)}</td>
        <td>${stus.reduce((acc, curr) => acc + curr.math, 0)}</td>
        <td>${stus.reduce((acc, curr) => acc + curr.star, 0)}</td>
      </tr>
      <tr>
        <td colspan="2">평균</td>
        <td>${stus.reduce((acc, curr) => acc + curr.kor, 0) / stus.length}</td>
        <td>${stus.reduce((acc, curr) => acc + curr.eng, 0) / stus.length}</td>
        <td>${stus.reduce((acc, curr) => acc + curr.math, 0) / stus.length}</td>
        <td>${stus.reduce((acc, curr) => acc + curr.star, 0) / stus.length}</td>
      </tr>`

        
  </script>
</body>

</html>